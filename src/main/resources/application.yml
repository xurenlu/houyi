spring:
  application:
    name: houyi
  servlet:
    multipart:
      max-file-size: 2048000
      max-request-size: 2048000
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        format_sql: true
        show_sql: false
        dialect: org.hibernate.dialect.MySQLDialect
  redis:
    host: ${REDIS_HOST:127.0.0.1}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: ${REDIS_DATABASE:0}
  config:
    import:
      - optional:classpath:wework-corps.yml

server:
  port: ${SERVER_PORT:8080}

management:
  endpoints:
    health:
      show-details: always
    web:
      exposure:
        include: "*"
      base-path: /houyi-eye

log:
  path: ${LOG_PATH:/tmp/}

# 线程池配置
thread-pool:
  download:
    core-size: 8
    max-size: 100
    queue-capacity: 10000
  oss:
    core-size: 4
    max-size: 60
    queue-capacity: 10000

# 后羿配置
houyi:
  aliyun:
    bucket: ${ALIYUN_OSS_BUCKET:wechat-monitoring}
    oss-endpoint: ${ALIYUN_OSS_ENDPOINT:oss-cn-shanghai.aliyuncs.com}
    oss-access-key: ${ALIYUN_OSS_ACCESS_KEY:}
    oss-access-secret: ${ALIYUN_OSS_ACCESS_SECRET:}
    key: ${ALIYUN_ACCESS_KEY:}
    secret: ${ALIYUN_ACCESS_SECRET:}
  download:
    temp-path: /tmp/
    max-retry-count: 16
    big-file-timeout-ms: 300000

# RocketMQ 5.0 配置（统一使用 TCP 协议）
rocketmq:
  nameSrvAddr: ${ROCKETMQ_NAME_SRV_ADDR:}
  topic: ${ROCKETMQ_TOPIC:wechat-archive-msg}
  retry-topic: ${ROCKETMQ_RETRY_TOPIC:wechat-archive-retry}
  groupId: ${ROCKETMQ_GROUP_ID:}
  retry-group-id: ${ROCKETMQ_RETRY_GROUP_ID:}
  tag: ${ROCKETMQ_TAG:ChatDataJava}
  namespace: ${ROCKETMQ_NAMESPACE:}
  public-endpoint: ${ROCKETMQ_PUBLIC_ENDPOINT:}
  retry-delay-ms: ${ROCKETMQ_RETRY_DELAY_MS:30000}

# Redis 消息队列配置（替代 RocketMQ）
redis:
  mq:
    enabled: ${REDIS_MQ_ENABLED:true}  # 设置为 true 启用 Redis MQ，false 使用 RocketMQ
    topic: ${REDIS_MQ_TOPIC:mq:topic:main}
    retry-topic: ${REDIS_MQ_RETRY_TOPIC:mq:topic:retry}
    delay-queue-key: ${REDIS_MQ_DELAY_QUEUE_KEY:mq:delay:queue}
    consumer-group: ${REDIS_MQ_CONSUMER_GROUP:houyi-consumer-group}
    retry-consumer-group: ${REDIS_MQ_RETRY_CONSUMER_GROUP:houyi-retry-consumer-group}
    tag: ${REDIS_MQ_TAG:default}
    retry-delay-ms: ${REDIS_MQ_RETRY_DELAY_MS:30000}
    batch-size: ${REDIS_MQ_BATCH_SIZE:10}
    poll-interval-ms: ${REDIS_MQ_POLL_INTERVAL_MS:1000}
    delay-scan-interval-ms: ${REDIS_MQ_DELAY_SCAN_INTERVAL_MS:1000}

# 保持向后兼容
aliyun:
  bucket: ${ALIYUN_OSS_BUCKET:wechat-monitoring}
  oss_end_point: ${ALIYUN_OSS_ENDPOINT:oss-cn-shanghai.aliyuncs.com}
  oss_access_key: ${ALIYUN_OSS_ACCESS_KEY:}
  oss_access_secret: ${ALIYUN_OSS_ACCESS_SECRET:}
  key: ${ALIYUN_ACCESS_KEY:}
  secret: ${ALIYUN_ACCESS_SECRET:}
